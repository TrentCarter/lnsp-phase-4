# Repository Guidelines

## Project Structure & Module Organization
- `app/` contains core runtime: `agents/` for orchestrators, `mamba/` and `nemotron_vmmoe/` for model training/inference, `utils/` for shared helpers. CLI entrypoints live under `app/cli/` and `app/pipeline/run_project.py`.
- `scripts/` hosts operational tooling (data downloads, triplet generation, MLFlow startup); treat each subfolder as environment-specific.
- `tests/` covers regression suites and CLI smoke checks; top-level `test_*.py` files are legacy integration harnesses.
- `docs/how_to_use_jxe_and_ielab.md` walks through accessing Triplet Vector Vault (TTV) and Vector Triplet Toolkit (VTT); reference it before touching shared endpoints.
- `data/`, `outputs/`, `mlruns/`, and `logs/` store local artifacts; keep large assets out of version control and prefer symlinks or `.gitignore`d folders listed in `path_config`.

## Build, Test, and Development Commands
- Create an isolated env: `python3 -m venv venv && source venv/bin/activate`.
- Install deps: `python -m pip install -r requirements.txt` (append `requirements_ielab.txt` when exercising IELab adapters).
- Lint fast: `ruff check app tests scripts`.
- Run targeted tests: `pytest tests/lnsp_vec2text_cli_main_test.py -k smoke`.
- Full pipeline dry-run: `python app/pipeline/run_project.py --project-config docs/sample_project.json`.
- Launch MLFlow locally (port 5007): `bash scripts/start_mlflow.sh`.

## Coding Style & Naming Conventions
- Python 3.11+, 4-space indentation, trailing commas for multi-line literals.
- Prefer explicit imports from `app.*`; avoid relative imports outside package roots.
- Functions and modules use `snake_case`, classes `PascalCase`, constants `UPPER_SNAKE`.
- Keep functions under ~80 lines; move shared logic into `app/utils/`.
- Run `ruff --fix` only after reviewing warnings; do not auto-format code generated by third-party exports without review.

## Testing Guidelines
- Pytest drives all suites; keep new tests under `tests/` mirroring module paths (`tests/pipeline/...`).
- Name fixtures descriptively and tag long-running jobs with `pytest.mark.slow`.
- For GPU/MPS-dependent checks, guard with `pytest.importorskip("torch")` or feature flags to keep CI green.
- Capture CLI regressions with the existing `lnsp_vec2text_*` tests; prefer parametrizing over duplicating files.

## Commit & Pull Request Guidelines
- Follow `<type>: <short description>` (types seen: `feat`, `fix`, `docs`); keep summary under 72 chars.
- Squash WIP commits before review; rebase onto `main` to avoid merge commits.
- PRs must include: scope summary, affected scripts/models, validation commands with links to `output/` artifacts, and any MLFlow run IDs.
- Mention required secrets or dataset prerequisites in the description; attach screenshots for dashboard/UI changes when feasible.
- Request expert review when touching `app/mamba/` or `app/nemotron_vmmoe/` as these affect live training.
