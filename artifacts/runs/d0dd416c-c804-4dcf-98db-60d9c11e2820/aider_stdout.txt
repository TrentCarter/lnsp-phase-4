m flake8 
--select=E9,F821,F823,F831,F406,F407,F701,F702,F704,F706 --show-source 
--isolated tests/test_db.py

tests/test_db.py:14:5: F821 undefined name 'faiss'
    faiss.write_index(faiss_db.index, index_path)
    ^
tests/test_db.py:17:20: F821 undefined name 'faiss'
    loaded_index = faiss.read_index(index_path)
                   ^
tests/test_db.py:18:37: F821 undefined name 'faiss'
    assert isinstance(loaded_index, faiss.IndexFlatL2)
                                    ^

## See relevant lines below marked with █.

tests/test_db.py:
...⋮...
  4│def test_save_and_load():
  5│    # Create a temporary FAISS index file
  6│    index_path = 'artifacts/temp_index.index'
...⋮...
 11│    faiss_db.add(vectors)
 12│
 13│    # Save the FAISS index
 14█    faiss.write_index(faiss_db.index, index_path)
 15│
 16│    # Load the FAISS index
 17█    loaded_index = faiss.read_index(index_path)
 18█    assert isinstance(loaded_index, faiss.IndexFlatL2)
 19│
 20│    # Clean up
 21│    os.remove(index_path)
 22│
...⋮...


To fix the errors in tests/test_ingest_pipeline.py and tests/test_db.py, we need
to import the faiss module at the beginning of each file.                       

Let's update the files accordingly:                                             

tests/test_ingest_pipeline.py                                                   

                                                                                
@@ -1,4 +1,6 @@                                                                 
 import os                                                                      
 from unittest.mock import patch                                                
+import faiss  # Add this line                                                  
 from src.ingest_pipeline import IngestPipeline, FaissDB                        
                                                                                
 def test_save_faiss_index():                                                   
     # Mock the FAISS index and database                                        
     mock_index = faiss.IndexFlatL2(128)                                        
@@ -9,5 +10,6 @@                                                                
     mock_db.index = mock_index                                                 
tests/test_db.py                                                                

                                                                                
@@ -1,3 +1,5 @@                                                                 
 import os                                                                      
 from src.db import FaissDB                                                     
+import faiss  # Add this line                                                  
                                                                                
 def test_save_and_load():                                                      
     # Create a temporary FAISS index file                                      
     index_path = 'artifacts/temp_index.index'                                  
     faiss_db = FaissDB(index_path=index_path)                                  
                                                                                
     # Add some vectors to the database                                         
These changes should resolve the F821 undefined name 'faiss' errors in both     
files.                                                                          

Tokens: 6.9k sent, 583 received.
Applied edit to tests/test_ingest_pipeline.py
Applied edit to tests/test_db.py
Commit c931379 fix: Import `faiss` module in tests to resolve undefined name 
errors
Summarization failed for model ollama/qwen2.5-coder:7b-instruct: cannot schedule new futures after shutdown
Summarization failed for model ollama/qwen2.5-coder:7b-instruct: cannot schedule new futures after shutdown
summarizer unexpectedly failed for all models
