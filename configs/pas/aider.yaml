# Aider-LCO Configuration for PAS Integration
#
# This file configures the Aider RPC wrapper for integration with PAS
# (Project Agentic System).
#
# Environment variable overrides (highest priority):
#   PAS_PORT, PAS_HOST, PAS_REGISTRY_URL, AIDER_MODEL, etc.

# Service configuration
agent: "Aider-LCO"
service_type: "agent"
role: "execution"
version: "0.1.0"

# Network configuration
network:
  host: "127.0.0.1"
  port: 6150
  rpc_protocol: "http"  # http|websocket (future)

# Registry integration
registry:
  enabled: true
  url: "http://127.0.0.1:6121"
  heartbeat_interval_s: 60
  ttl_s: 90  # heartbeat_interval + 30s buffer
  auto_register: true

# Aider model configuration (v0.86.1)
model:
  primary: "ollama/qwen2.5-coder:7b-instruct"  # Fast, free, local
  # Alternatives (best quality):
  # primary: "anthropic/claude-3-7-sonnet"     # Best overall (paid)
  # primary: "deepseek/deepseek-r1"            # Best quality/cost (paid)
  # primary: "ollama/deepseek-r1:14b"          # Best local (14B)
  # primary: "openai/o1"                        # Best reasoning (paid)

  editor: ""  # Optional separate editor model (leave empty to use primary)
  temperature: 0.7
  context_limit: 131072  # 128K tokens

  # New in v0.85+: Thinking token budget for reasoning models
  thinking_tokens: 10000  # For models with extended thinking (o1, o3, gemini-2.5)

# Model routing (for different task types)
model_routing:
  code_refactor: "ollama/qwen2.5-coder:7b-instruct"
  doc_update: "ollama/qwen2.5-coder:7b-instruct"
  test_fix: "ollama/qwen2.5-coder:7b-instruct"
  bug_fix: "ollama/qwen2.5-coder:7b-instruct"

# Capabilities advertised to Gateway/Registry
capabilities:
  - "git-edit"           # Multi-file editing with git integration
  - "pytest-loop"        # Test runner with auto-fix loop
  - "repo-map"           # Repository mapping for context
  - "multi-file-edit"    # Coordinated changes across files
  - "auto-commit"        # Automatic git commits
  - "diff-planning"      # Change planning before execution

# Rights policy (matches PAS PRD security model)
rights:
  file: "rw"      # Read/write file operations
  bash: "x"       # Execute bash (with allowlist)
  git: "x"        # Git operations
  python: "x"     # Python/pytest execution
  network: "rw"   # Network operations (for model API)

# Budget constraints (soft limits, Token Governor enforces globally)
budgets:
  max_tokens_per_job: 80000
  max_cost_per_job_usd: 2.50
  max_duration_per_job_s: 600  # 10 minutes

# Context management (50-75% policy)
context:
  limit: 131072
  warning_threshold: 0.50  # Warn at 50% usage
  critical_threshold: 0.75  # Save-state + clear at 75%
  auto_save_state: true

# Artifact storage
artifacts:
  cost_dir: "artifacts/costs"        # Receipt storage
  log_dir: "artifacts/hmi/events"    # Execution logs
  diff_dir: "artifacts/diffs"        # Git diffs
  retain_days: 30

# Security (Phase 2 hardening)
security:
  command_allowlist_enabled: true
  secrets_redaction_enabled: true
  audit_log_enabled: true
  audit_log_signed: false  # Enable for production
  air_gapped_mode: false   # Set true for isolated deployments

# Allowed file system roots (security sandbox)
allowed_roots:
  - "/Users/trentcarter/Artificial_Intelligence/AI_Projects/lnsp-phase-4"
  - "/tmp"
  - "/var/tmp"

# Logging
logging:
  level: "INFO"  # DEBUG|INFO|WARNING|ERROR
  format: "json"  # json|text
  output: "stdout"  # stdout|file

# Performance tuning
performance:
  max_concurrent_jobs: 1  # Aider is single-threaded
  queue_depth_limit: 5
  startup_warmup_s: 2

# Metrics for heartbeat
metrics:
  track_p95_latency: true
  track_token_usage: true
  track_cost: true
  track_quality_kpis: true

# Labels for Gateway routing
labels:
  editor: "aider"
  space: "n/a"
  lane: "code"
  tier: "execution"

# Git configuration
git:
  auto_commit: true
  commit_message_template: |
    {task}: {summary}

    - {changes}

    Run ID: {run_id}
    Generated by Aider-LCO
  conventional_commits: true
  pre_commit_hooks: true
  commit_language: "en"  # New in v0.85: Specify language for commit messages
  add_gitignore_files: false  # New in v0.85: Include .gitignore-listed files

# Test runner configuration
test:
  auto_run: true
  auto_fix_on_failure: true
  max_fix_iterations: 3
  frameworks:
    - "pytest"
    - "unittest"

# Experimental features (disabled by default)
experimental:
  voice_input: false
  browser_automation: false
  multi_agent_collaboration: false
