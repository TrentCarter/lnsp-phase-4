{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "heartbeat.schema.json",
  "title": "Heartbeat",
  "description": "Schema for agent/service heartbeat updates (HMI PRD ยง7)",
  "type": "object",
  "required": ["service_id", "ts", "status"],
  "properties": {
    "service_id": {
      "type": "string",
      "description": "Service identifier from registration",
      "format": "uuid"
    },
    "run_id": {
      "type": ["string", "null"],
      "description": "Current run/job identifier (if applicable)"
    },
    "agent": {
      "type": ["string", "null"],
      "description": "Agent name (if this is an agent heartbeat)"
    },
    "ts": {
      "type": "string",
      "description": "Timestamp (ISO 8601)",
      "format": "date-time"
    },
    "progress": {
      "type": "number",
      "description": "Task progress ratio (0.0 to 1.0)",
      "minimum": 0,
      "maximum": 1
    },
    "status": {
      "type": "string",
      "description": "Current service/agent status",
      "enum": ["ok", "degraded", "down", "queued", "running", "blocked", "waiting_approval", "paused", "error", "done"]
    },
    "message": {
      "type": "string",
      "description": "Optional status message"
    },
    "token_usage": {
      "type": "object",
      "description": "Context window usage",
      "properties": {
        "ctx_used": {
          "type": "integer",
          "description": "Tokens used in current context",
          "minimum": 0
        },
        "ctx_limit": {
          "type": "integer",
          "description": "Maximum context window size",
          "minimum": 0
        }
      },
      "required": ["ctx_used", "ctx_limit"]
    },
    "resources": {
      "type": "object",
      "description": "Resource usage snapshot",
      "properties": {
        "cpu": {
          "type": "number",
          "description": "CPU cores in use",
          "minimum": 0
        },
        "mem_mb": {
          "type": "number",
          "description": "Memory usage in MB",
          "minimum": 0
        },
        "gpu_mem_mb": {
          "type": "number",
          "description": "GPU memory usage in MB",
          "minimum": 0
        }
      }
    },
    "p95_ms": {
      "type": "number",
      "description": "P95 latency in milliseconds",
      "minimum": 0
    },
    "queue_depth": {
      "type": "integer",
      "description": "Number of pending requests",
      "minimum": 0
    },
    "load": {
      "type": "number",
      "description": "Load factor (0.0 to 1.0)",
      "minimum": 0,
      "maximum": 1
    },
    "llm_model": {
      "type": "string",
      "description": "LLM model name (if this agent uses an LLM)",
      "examples": [
        "ollama/qwen2.5-coder:7b-instruct",
        "anthropic/claude-3-7-sonnet",
        "openai/gpt-4o",
        "deepseek/deepseek-r1"
      ]
    },
    "llm_provider": {
      "type": "string",
      "description": "LLM provider (if applicable)",
      "enum": ["ollama", "anthropic", "openai", "deepseek", "local", "other"]
    },
    "parent_agent": {
      "type": "string",
      "description": "Parent agent name (for hierarchical tracking)"
    },
    "children_agents": {
      "type": "array",
      "description": "List of child agent names",
      "items": {
        "type": "string"
      }
    }
  },
  "additionalProperties": false
}
