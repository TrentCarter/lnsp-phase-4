[Architect]
Lnsprag/gwom Qc & Backfill Toolkit (v0

LNSPRAG/GWOM QC & Backfill Toolkit (v0.1)

Author: Trent Carter + ChatGPT‑5
Target: Python 3.11, stdlib‑only (no external deps)
Layout assumes LNSPRAG PRD directories under artifacts/

0) File Map

tools/lnsprag_validator.py — CI validator + ASCII dashboard
tools/cpesh_backfill.py — build context windows for thin/missing CPESH and emit backfill batches
tools/tmd_histogram_report.py — TMD distribution & domain confusion checks
Makefile snippets — lnsp-status, lnsprag-validate, cpesh-backfill
1) tools/lnsprag_validator.py








2) tools/cpesh_backfill.py





3) tools/tmd_histogram_report.py
















4) Makefile Snippets







5) Example CI Usage



6) Next Steps (drop-in ready)

Wire cpesh_backfill.py output into your CPESH builder (LLM step) and append to artifacts/cpesh_active.jsonl, then rotate.
Run lnsprag_validator.py nightly in CI. Keep the ASCII gate visible to the team.
Use tmd_histogram_report.py after any extractor change to verify TMD isn’t defaulting.
Dropped a full, ready-to-run toolkit in the canvas:
tools/lnsprag_validator.py — prints the ASCII dashboard and enforces the thresholds you wanted (mean words, P95, TMD default rate, CPESH attach rate). Non-zero exit on fail unless --warn-only.
tools/cpesh_backfill.py — batches thin/default-TMD chunks into 180–320-word windows for a clean CPESH rebuild; emits a JSONL you can feed to the builder.
tools/tmd_histogram_report.py — TMD distribution plus a crude domain-mismatch check (e.g., section hints vs TMD domain).
Makefile targets: lnsprag-validate, lnsp-status, cpesh-backfill, tmd-report.
How to use (quick):
# 1) Validate & see the ASCII status
python3 tools/lnsprag_validator.py \
  --chunks-jsonl artifacts/cpesh_active.jsonl \
  --cpesh-jsonl  artifacts/cpesh_active.jsonl \
  --tmd-default  9.1.27 \
  --min-words    120 \
  --p95-target   250

# 2) Create backfill windows for CPESH builder
python3 tools/cpesh_backfill.py \
  --chunks-jsonl artifacts/cpesh_active.jsonl \
  --out-jsonl    artifacts/cpesh_backfill_windows.jsonl \
  --min-words    180 --max-words 320

# 3) TMD health / dominance check
python3 tools/tmd_histogram_report.py \
  --chunks-jsonl artifacts/cpesh_active.jsonl --top-n 30
If your chunk JSONL/CPESH JSONL are split, just point --chunks-jsonl to the chunk file and --cpesh-jsonl to the CPESH file; the validator handles interval overlaps via chunk_position.

